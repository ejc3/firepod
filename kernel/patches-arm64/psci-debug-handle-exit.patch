From: fcvm <fcvm@local>
Subject: [PATCH 1/3] Add PSCI debug logging to handle_exit.c

--- a/arch/arm64/kvm/handle_exit.c
+++ b/arch/arm64/kvm/handle_exit.c
@@ -56,12 +56,19 @@
 
 static int handle_smc(struct kvm_vcpu *vcpu)
 {
+	int ret;
+
+	pr_debug("[KVM PSCI DEBUG] handle_smc called\n");
+
 	/*
 	 * Forward this trapped smc instruction to the virtual EL2 if
 	 * the guest has asked for it.
 	 */
-	if (forward_smc_trap(vcpu))
+	if (forward_smc_trap(vcpu)) {
+		pr_debug("[KVM PSCI DEBUG] SMC forwarded to virtual EL2\n");
 		return 1;
+	}
+	pr_debug("[KVM PSCI DEBUG] SMC NOT forwarded, handling as SMCCC\n");
 
 	/*
 	 * "If an SMC instruction executed at Non-secure EL1 is
@@ -91,7 +98,9 @@
 	 * at Non-secure EL1 is trapped to EL2 if HCR_EL2.TSC==1, rather than
 	 * being treated as UNDEFINED.
 	 */
-	return kvm_smccc_call_handler(vcpu);
+	ret = kvm_smccc_call_handler(vcpu);
+	pr_debug("[KVM PSCI DEBUG] kvm_smccc_call_handler returned %d\n", ret);
+	return ret;
 }
 
 /*
