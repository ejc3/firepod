# Minimal pjdfstest container
#
# Build:
#   podman build -t pjdfstest -f Containerfile.pjdfstest .
#
# Run:
#   podman run --rm -v /mnt/fuse:/testdir pjdfstest prove -v -j 8 -r /opt/pjdfstest/tests/

FROM docker.io/library/debian:bookworm-slim

# Install only what's needed for pjdfstest
RUN apt-get update && apt-get install -y \
    autoconf \
    automake \
    libtool \
    gcc \
    make \
    libc-dev \
    perl \
    git \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Build pjdfstest
RUN git clone --depth 1 https://github.com/pjd/pjdfstest /opt/pjdfstest \
    && cd /opt/pjdfstest \
    && autoreconf -ifs \
    && ./configure \
    && make

WORKDIR /testdir

# No entrypoint - just run whatever command is passed
CMD ["prove", "-v", "-j", "8", "-r", "/opt/pjdfstest/tests/"]
